<!DOCTYPE html>
<html>
<head>
	<style>
		body {
			font-family: Arial;
		}
		ul {
			width: 300px;
			padding: 10px;
			list-style: none;
			line-height: 30px;
			background: #f3f3f3;
		}
		li > .text, li > input[type=text] {
			width: 250px;
		}
		.delete-button {
			float: right;
			cursor: pointer;
		}
		.filter {
			margin-right: 10px;
		}
		.filter:not(.active) {
			color: blue;
			cursor: pointer;
			text-decoration: underline;
		}
	</style>
	<script src="../../databind.js"></script>
	<script>
		items = [];
		editItem = null;
		filters = ["All", "Active", "Completed"];
		currentFilter = "All";
		
		function toggleClass(elem, className, toggle) {
			if (toggle) elem.className += " " + className;
			else elem.className = elem.className.replace(new RegExp("(?:^|\\s)" + className + "(?!\\S)", "g"), "");
		}
		function setVisible(elem, toggle) {
			elem.style.display = toggle ? "" : "none";
		}
	</script>
</head>
<body>
	<h1>TODO</h1>
	<div>
		<span class="filter"
			bind-repeater-i="#filters.length"
			bind-statement-1="toggleClass(thisElem, 'active', #currentFilter == #filters[#i])"
			bind-event-click="#currentFilter = #filters[#i]">{{#filters[#i]}}</span>
	</div>
	<ul>
		<li>
			<input type="checkbox"
				bind-statement-1="thisElem.disabled = !#items.length"
				bind-event-change="#items.forEach(function(item) {item.completed = thisElem.checked})" />
			<input type="text" placeholder="What to do?"
				bind-event-keypress="if (event.which == 13) { #items.push({text: thisElem.value}); thisElem.value = ''; return false; }" />
		</li>
		<li bind-repeater-i="#items.length"
			bind-var-item="#items[#i]"
			bind-statement-1="setVisible(thisElem, #currentFilter == 'All' || #currentFilter == 'Active' && !#items[#i].completed || #currentFilter == 'Completed' && !!#items[#i].completed)">
			<div class="delete-button"
				bind-event-click="#items.splice(#items.indexOf(#item), 1)">X</div>
			<input type="checkbox"
				bind-statement-1="thisElem.checked = #item.completed"
				bind-event-change="#item.completed = thisElem.checked" />
			<span class="text"
				bind-statement-1="thisElem.style.display = #item != #editItem ? 'inline-block' : 'none'"
				bind-statement-2="thisElem.style.textDecoration = #item.completed ? 'line-through' : 'none'"
				bind-event-click="#editItem = #item">
				{{#item.text}}
			</span>
			<input type="text"
				bind-statement-1="thisElem.value = #item.text"
				bind-statement-2="setVisible(thisElem, #item == #editItem); if (#item == #editItem) thisElem.focus()"
				bind-event-keypress="if (event.which == 13) { #item.text = thisElem.value; #editItem = null; return false; }" />
		</li>
	</ul>
	<div>
		<input type="button" value="Clear Completed"
			bind-event-click="#items = #items.filter(function(item) {return !item.completed})" />
	</div>
</body>
</html>
